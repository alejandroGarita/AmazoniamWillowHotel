@{
    /**/

    ViewBag.Title = "Reservar en linea";
}

<div class="modal modal-static fade" id="processing-modal" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="text-center">
                    <img src="~/Public/images/loading.gif" class="icon-modal" />
                    <h5><span class="modal-text">Verificando disponibilidad, Espere por favor... </span></h5>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <h2>@ViewBag.Title</h2>
    <br />
    <div>
        <div class="formulario">
            <div class="banner-formulario">
                @Html.Label("Tipo de Habitación")
                <select name="TipoHabitacion" id="TipoHabitacion" class="form-control">
                    @foreach (var item in (List<AmazoniamWillowHotel.Models.Tipo_Habitacion>)ViewData["types"])
                    {
                        <option value="@item.Id_Tipo_Habitacion">@item.Titulo</option>
                    }
                </select>
            </div>
        </div>
        <br />
        @using (Html.BeginForm("ReservationClient", "Reservation", FormMethod.Post, new { id = "myForm" }))
        {
            <input type="hidden" id="numero" name="numero" class="form-control" />
            <input type="hidden" id="titulo" name="titulo" class="form-control" />
            <input type="hidden" id="descripcion" name="descripcion" class="form-control" />
            <input type="hidden" id="tarifa" name="tarifa" class="form-control" />
            <input type="hidden" id="imagen" name="imagen" class="form-control" />
            <div class="formulario">
                <div class="banner-formulario">
                    @Html.Label("Fecha de Llegada")
                    <input type="text" id="fechaLlegada" name="fechaLlegada" class="form-control" value="dd/mm/aaaa" />
                </div>
                <div class="banner-formulario">
                    @Html.Label("Fecha de Salida")
                    <input type="text" id="fechaSalida" name="fechaSalida" class="form-control" value="dd/mm/aaaa" />
                </div>
            </div>
        }
        <p id="spanFecha" class="text-danger"></p>
        <br />
        <div>
            <div style="text-align: center;">
                <input value="Aceptar" id="Aceptar" name="Aceptar" type="button" class="btn btn-default">
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        var dateFormat = "dd/mm/yy",
            fechaLlegada = $("#fechaLlegada").datepicker({ minDate: 0, dateFormat: dateFormat })
                .on("change", function () {
                    fechaSalida.datepicker("option", "minDate", getDate(this));
                    fechaSalida.datepicker("setDate", "dd/mm/aaaa")
                }),
            fechaSalida = $("#fechaSalida").datepicker({ minDate: 0, dateFormat: dateFormat })
                .on("change", function () {
                    fechaLlegada.datepicker("option", "maxDate", getDate(this));
                });

        function getDate(element) {
            var date;
            try {
                date = $.datepicker.parseDate(dateFormat, element.value);
            } catch (error) {
                date = null;
            }
            return date;
        }
    });

    $("#Aceptar").click("click", function () {
        var fechaLlegada = $("#fechaLlegada").val();
        var fechaSalida = $("#fechaSalida").val();
        var tipoHabitacion = $("#TipoHabitacion").val();
        if (fechaLlegada != "" && fechaSalida != "") {
            var md = $("#processing-modal");
            md.modal('show');

            $.ajax({
                type: 'POST',
                url: "/Reservation/checkAvailability",
                dataType: 'json',
                data: { TipoHabitacion: tipoHabitacion, fechaLlegada: fechaLlegada, fechaSalida: fechaSalida },

                success: function (checkAvailability1) {
                    if (checkAvailability1 != "") {
                        if (checkAvailability1.descripcion == "No hay Habitaciones") {
                            md.modal('hide');
                            alert('No hay habitaciones disponibles');
                        } else {
                            md.modal('hide');
                            document.getElementById('numero').value = checkAvailability1.numero;
                            document.getElementById('titulo').value = checkAvailability1.titulo;
                            document.getElementById('descripcion').value = checkAvailability1.descripcion;
                            document.getElementById('tarifa').value = checkAvailability1.tarifa;
                            document.getElementById('imagen').value = checkAvailability1.imagen;
                            $("#myForm").submit();
                        }//if-else
                    }//if retorno algo
                },
                error: function (ex) {
                    md.modal('hide');
                    alert('Fallo al verificar la disponibilidad.' + ex);
                }
            });
        } else {
            document.getElementById("spanFecha").innerHTML = "Se requiere una fecha de llegada y una fecha de salida para la reservación";
        }//if-else
    });
</script>